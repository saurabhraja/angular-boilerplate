pipeline{
  agent any
  tools {
    git 'localGIT'
    jdk 'localJDK'
    nodejs 'localNode'
  }
  stages{
    stage ('Code Checkout') {
      steps {
        checkout scm
      }
    }
    stage ('Install Dependencies'){
      steps{
        bat '''
          echo 'Before npm install starts:'
          echo.
          dir /ad
          rm -rf node_modules
          npm install
        '''
      }
    }
    stage ('Run Tests'){
      steps{
        bat '''
          $(npm bin)ng test --single-run --browsers Chrome_no_sandbox
        '''
      }
      post {
          always {
            junit test-results.xml
          }
      }
    }
    stage ('Check Code Quality'){
      steps{
        bat '$(npm bin)ng lint'
      }
    }
    stage ('Build Project') {
      steps{
        bat '$(npm bin)ng build --prod --build-optimizer'
        bat '''
          echo 'This directory contains the following text files:'
          echo.
          dir /b *.txt
        '''
      }
    }
  }
}