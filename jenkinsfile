pipeline {
  agent any
  tools {
    git 'localGIT'
    jdk 'localJDK'
    nodejs 'localNode'
  }
  stages{
    stage ('Code Checkout') {
      steps {
        checkout scm
      }
    }
    stage ('Install Dependencies') {
      steps {
        def USER_INPUT = input (
            message: 'Install Dependencies ?',
            parameters: [
                    [$class: 'ChoiceParameterDefinition',
                      choices: ['No','Yes'].join('\n'),
                      name: 'input',
                      description: '']
            ])

        echo "The answer is: ${USER_INPUT}"

        if( "${USER_INPUT}" == "Yes"){
            bat '''
              echo 'Before npm install starts:'
              npm install
            '''
        } else {
            echo 'Installation skipped...'
        }
        
      }
    }
    stage ('Run Tests') {
      steps {
        bat '''
          ng test --single-run --browsers Chrome_no_sandbox
        '''
      }
    }
    stage ('Build Project') {
      steps {
        bat '''
          ng build --prod --build-optimizer
          echo 'This directory contains the following text files:'
          echo.
          dir /b *.txt
        '''
        
      }
    }
  }
}